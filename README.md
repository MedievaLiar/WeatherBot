
# PiterMoment

Телеграм-бот, собирающий прогноз погоды с разных источников, усредняющий их и отправляющий пользователю ответ. Полностью написан на Go.

# Возможности

1) Получение прогноза на сейчас, сегодня, завтра

2) Источники данных:

 - [Gismeteo (HTML-парсинг)](https://www.gismeteo.ru/)
 - [Яндекс.Погода (HTML-парсинг)](https://yandex.ru/pogoda/ru/fiorentino?via=reg&lat=43.909068&lon=12.459716)
 - [OpenWeatherMap API](https://openweathermap.org)
 - [AccuWeather API](https://www.accuweather.com/)
 - [Sunrise-Sunset API](https://sunrise-sunset.org/)
 - [NASA (шутка)]()

3) Поддержка ежедневной автоматической рассылки прогноза

4) Кэширование с TTL:

* now: 30 минут

* today: 3 часа

* tomorrow: 6 часов

5) Обработка данных с агрегацией по температуре, осадкам, ветру, влажности.

6) Приятные сообщения и интуитивное управление

# Структура проекта
```weather_bot/
├── bot/                   # Telegram-бот и логика общения
│   ├── messages/          # Шаблоны сообщений
│   ├── storage/           # Кэш прогнозов и пользователей
│   └── bot.go             # Главная точка входа в бота
├── aggregator/            # Сбор и агрегация данных
│   ├── format/            # Приведение к общему формату
│   └── weather_sources/   # Источники погоды
├── config/                # Ключи, данные городов
├── models/                # Модели данных
├── main.go                # Точка запуска
├── go.mod / go.sum        # Зависимости
└── README.md              # You are here
```

# Зависимости

```module weather_bot

go 1.24.2

require (
	github.com/PuerkitoBio/goquery v1.10.3                      // HTML-парсинг
	github.com/go-telegram-bot-api/telegram-bot-api/v5 v5.5.1   // Telegram API
	github.com/robfig/cron/v3 v3.0.1                            // Планировщик задач
	gopkg.in/yaml.v3 v3.0.1                                     // Работа с YAML
)
```
Получаются через

```
go get github.com/PuerkitoBio/goquery
```

# Требования

Go ≥ 1.20 (рекомендуется 1.24.2)

Наличие API-ключей:

    OpenWeatherMap

    AccuWeather
        - нужен один главный API ключ, через него получаются локальные ключи для городов, есть файл парсера localKey

Telegram-бот токен

YAML-файлы в ./config/ с ключами и настройками

# Установка и запуск

1) Установить Go:
https://go.dev/doc/install

2) Клонировать репозиторий:
```
git clone https://github.com/твой-ник/weather_bot.git
cd weather_bot
```
3) Создать и заполнить файл с ключами:

* config/api_keys.yaml

* config/accu_keys.yaml

* пример файлов можно взять из config/example_*.yaml

4) Запуск бота:
```
go run main.go
```
#  Как работает агрегация

Собираются данные с разных источников.

Все прогнозы конвертируются в общий формат.

Вычисляется среднее значение для каждой переменной (температура, температу по ощущению, скорость ветра, влажность).

Результат форматируется в итоговый вывод и отправляется пользователю.

# Примечания

- Парсинг Gismeteo и Яндекса может ломаться при смене верстки сайтов, особенно Яндекса.

- Для парсинга используется goquery.

- Хранение пользователей и кэша реализовано без базы данных — через сериализацию YAML.

# Планы на будущее

Перенос хранилища на БД

Панель администрирования

# Автор

purple, 2025

Проект создан в свободное время из практической необходимости и интереса к программированию на Go.

